# Gitea çš„å®‰è£…ä¸åŸºç¡€é…ç½®ï¼ˆDocker Compose æ–¹å¼ï¼‰

> æœ¬èŠ‚å°†æŒ‡å¯¼ä½ å®Œæˆ **ä½¿ç”¨ Docker Compose å®‰è£… Gitea** çš„å…¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬å‡†å¤‡ç¯å¢ƒã€é…ç½® Compose æ–‡ä»¶ã€å¯åŠ¨æœåŠ¡åŠç®€å•é…ç½®ã€‚

## ğŸ¯ æ•™ç¨‹ç›®æ ‡

- æœ¬èŠ‚ä½ å°†å­¦åˆ°ï¼š
  - å¦‚ä½•ç¼–å†™ docker-compose.ymlæ¥ å®‰è£… Giteaï¼›
  - å¦‚ä½•é…ç½® Gitea çš„æœåŠ¡å‚æ•°å’Œæ•°æ®å­˜å‚¨ï¼›
  - å¦‚ä½•é€šè¿‡æµè§ˆå™¨è®¿é—®å¹¶åˆå§‹åŒ– Gitea å®ä¾‹ã€‚

## ğŸ“¦ æ­¥éª¤è¯´æ˜

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä½ çš„ç³»ç»Ÿä¸­å·²ç»å®‰è£…äº†ä»¥ä¸‹ç»„ä»¶ï¼š

- Docker
- Docker Compose

å¦‚æœªå®‰è£…ï¼Œå¯å‚è€ƒå‰é¢çš„ç« èŠ‚ï¼š[ä¸€é”®å®‰è£… Docker](../../docker/one-click-install/README.md)

### 2. åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„

```bash
sudo mkdir -p /opt/docker/gitea
cd /opt/docker/gitea
```

### 3. ç¼–å†™ `docker-compose.yml` æ–‡ä»¶

åœ¨ `/opt/docker/gitea` ç›®å½•ä¸‹åˆ›å»º `docker-compose.yml`ï¼š

```yaml
version: "3.8" # å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„docker compose è¯·åˆ é™¤æ­¤è¡Œ

services:
  gitea:
    image: gitea/gitea:latest  # ä½¿ç”¨å®˜æ–¹ Gitea æœ€æ–°ç‰ˆæœ¬é•œåƒ
    container_name: gitea      # å®¹å™¨çš„åå­—ï¼Œæ–¹ä¾¿è¯†åˆ«

    environment:               # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œé…ç½® Gitea å¯åŠ¨å‚æ•°
      - USER_UID=1000
      - USER_GID=1000
      - GITEA__database__DB_TYPE=postgres     # ä½¿ç”¨ PostgreSQL ä½œä¸ºæ•°æ®åº“
      - GITEA__database__HOST=gitea-db:5432   # æ•°æ®åº“ä¸»æœºåœ°å€å’Œç«¯å£ï¼ˆæŒ‡å‘ä¸‹é¢çš„æœåŠ¡ï¼‰
      - GITEA__database__NAME=gitea           # æ•°æ®åº“åç§°
      - GITEA__database__USER=gitea           # æ•°æ®åº“ç”¨æˆ·å
      - GITEA__database__PASSWD=s1tGsUUMAWLq      # å»ºè®®å¼ºå¯†ç 

    restart: unless-stopped    # å®¹å™¨åœ¨éæ­£å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ï¼Œé™¤éæ‰‹åŠ¨åœæ­¢

    volumes:                  # å°†ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œå®ç°æ•°æ®æŒä¹…åŒ–
      - ./gitea:/data         # Gitea æ ¸å¿ƒæ•°æ®ï¼ˆä»“åº“ã€ç”¨æˆ·æ–‡ä»¶ç­‰ï¼‰
      - /etc/timezone:/etc/timezone:ro    # å…±äº«ä¸»æœºæ—¶åŒºé…ç½®ï¼Œåªè¯»æŒ‚è½½
      - /etc/localtime:/etc/localtime:ro  # å…±äº«ä¸»æœºæ—¶é—´è®¾ç½®ï¼Œåªè¯»æŒ‚è½½

    ports:                    # ç«¯å£æ˜ å°„ï¼Œä¸»æœº â†’ å®¹å™¨
      - "3100:3000"           # ç½‘é¡µ UIï¼šä¸»æœº 3100 æ˜ å°„å®¹å™¨ 3000
      - "2222:22"             # SSH è®¿é—®ï¼šä¸»æœº 2222 æ˜ å°„å®¹å™¨ 22

    depends_on:              # å®šä¹‰ä¾èµ–å…³ç³»ï¼Œç¡®ä¿æ•°æ®åº“å…ˆå¯åŠ¨å¹¶å¥åº·åå†å¯åŠ¨ Gitea
      gitea-db:
        condition: service_healthy
  gitea-db:
    image: postgres:latest    # ä½¿ç”¨æœ€æ–° PostgreSQL é•œåƒ
    container_name: gitea_db  # å®¹å™¨åç§°
    environment:              # è®¾ç½® PostgreSQL çš„åˆå§‹åŒ–å‚æ•°
      - POSTGRES_USER=gitea          # åˆå§‹åŒ–æ•°æ®åº“ç”¨æˆ·
      - POSTGRES_PASSWORD=s1tGsUUMAWLq  # å»ºè®®å¼ºå¯†ç 
    volumes:
      - ./gitea-db:/var/lib/postgresql/data  # æœ¬åœ°ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…æ•°æ®ç›®å½•
    healthcheck:              # å¥åº·æ£€æŸ¥é…ç½®ï¼Œç¡®ä¿æ•°æ®åº“å·²å‡†å¤‡å¥½
      test: ["CMD-SHELL", "pg_isready -U gitea"]  # æµ‹è¯•æ•°æ®åº“æ˜¯å¦å¯è¿æ¥
      interval: 5s            # æ¯ 5 ç§’æ‰§è¡Œä¸€æ¬¡æ£€æŸ¥
      timeout: 5s             # æ£€æŸ¥è¶…æ—¶æ—¶é—´ 5 ç§’
      retries: 5              # è¿ç»­ 5 æ¬¡å¤±è´¥è§†ä¸ºä¸å¥åº·
    restart: unless-stopped    # å®¹å™¨åœ¨éæ­£å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ï¼Œé™¤éæ‰‹åŠ¨åœæ­¢
```

### 4. å¯åŠ¨æœåŠ¡

```bash
docker compose up -d
```

é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ç­‰å¾…æ•°ç§’é’Ÿåˆ° 1 åˆ†é’Ÿï¼Œå–å†³äºç½‘ç»œå’Œç³»ç»Ÿèµ„æºã€‚

### 5. è®¿é—® Gitea ç•Œé¢å¹¶åˆå§‹åŒ–

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š[http://<æœåŠ¡å™¨IP>:3100](http://172.21.235.129:3100)

ä¸å‡ºæ„å¤–ï¼Œæ‰€æœ‰å…³é”®å¿…å¡«é…ç½®å‡å·²æœ‰å€¼(å·²åœ¨ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šï¼Œä½†ä½ ä¾æ—§èƒ½åœ¨æ­¤é…ç½®ä¿®æ”¹ï¼Œä½†ä¸å»ºè®®ä¿®æ”¹)

å…¶ä»–è®¾ç½®ä¿æŒé»˜è®¤ï¼Œç‚¹å‡»â€œå®‰è£… Giteaâ€ã€‚

> åˆå§‹åŒ–å®Œæˆåå°†è‡ªåŠ¨è·³è½¬è‡³ç™»å½•é¡µé¢ã€‚

## ğŸ¥ è§†é¢‘åœ°å€

[Giteaçš„å®‰è£…ä¸åŸºç¡€é…ç½®](https://www.bilibili.com/video/BV1kX7izeEUY/)

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæˆ‘è®¿é—® [http://<æœåŠ¡å™¨IP>:3100](http://172.21.235.129:3100) é¡µé¢æ‰“ä¸å¼€ï¼Ÿ

- è¯·ç¡®è®¤ Docker æœåŠ¡æ­£åœ¨è¿è¡Œï¼›
- ä½¿ç”¨ `docker ps` æŸ¥çœ‹å®¹å™¨æ˜¯å¦å·²å¯åŠ¨ï¼›
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚

### Q: æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ

- æœ¬æ•™ç¨‹çš„ Docker Compose é…ç½®å·²æŒ‚è½½æœ¬åœ°ç›®å½•åˆ°å®¹å™¨ï¼Œå¯æŒä¹…åŒ–æ•°æ®ï¼›
- è¯·å®šæœŸå¤‡ä»½ `~/docker/gitea` ç›®å½•ä¸‹çš„æ•°æ®ã€‚
- å¦‚æœé‡åˆ°é‡å¯åï¼Œç™»å½•giteaå‘ç°æ˜æ˜ç”¨æˆ·åå¯†ç æ˜¯å¯¹çš„ä½†giteaæç¤ºé”™è¯¯(æ•°æ®ä¸¢å¤±)ï¼Œè¯·é‡å¯giteaçš„æ•°æ®åº“ï¼Œè¿™åº”è¯¥èƒ½è§£å†³é—®é¢˜

---

> æœ¬èŠ‚å†…å®¹éµå¾ª Apache 2.0 åè®®ï¼Œæ¬¢è¿å¼•ç”¨ä¸è½¬è½½ï¼Œéœ€ä¿ç•™åŸå§‹ç½²åã€‚
